@startuml process-architecture
!define RECTANGLE class

skinparam componentStyle rectangle
skinparam backgroundColor #FEFEFE
skinparam component {
    BackgroundColor<<main>> #E3F2FD
    BackgroundColor<<orchestrator>> #C8E6C9
    BackgroundColor<<attacker>> #FFCDD2
    BackgroundColor<<defender>> #FFF9C4
    BorderColor #333333
    ArrowColor #333333
}

title AgentBeats Security Arena - Process Architecture

package "Main Process" <<main>> {
    [run_scenario.py] as main
    note right of main
        Entry point
        Manages subprocess lifecycle
        Handles shutdown (SIGTERM/SIGKILL)
    end note
}

package "Process 1: Orchestrator (Port 9010)" <<orchestrator>> {
    [orchestrator.py] as orch
    [GreenExecutor] as green_exec
    [GenericArenaOrchestrator] as arena_orch
    [ScenarioPlugin] as plugin
    [ToolProvider] as tool_prov

    orch --> green_exec : creates
    green_exec --> arena_orch : wraps
    arena_orch --> plugin : loads
    arena_orch --> tool_prov : uses

    note right of orch
        Green Agent
        Coordinates battles
        HTTP Server (uvicorn)
        A2A Protocol
    end note
}

package "Process 2: Attacker (Port 9021)" <<attacker>> {
    [generic_attacker.py] as attacker
    [GenericAttackerExecutor] as att_exec
    [OpenAI Client\n(Attacker)] as att_llm

    attacker --> att_exec : creates
    att_exec --> att_llm : uses

    note right of attacker
        Purple Agent (Red Team)
        Generates attacks
        Maintains conversation history
        HTTP Server (uvicorn)
    end note
}

package "Process 3: Defender (Port 9020)" <<defender>> {
    [generic_defender.py] as defender
    [GenericDefenderExecutor] as def_exec
    [OpenAI Client\n(Defender)] as def_llm

    defender --> def_exec : creates
    def_exec --> def_llm : uses

    note right of defender
        Purple Agent (Blue Team)
        Defends against attacks
        Stateless evaluation
        HTTP Server (uvicorn)
    end note
}

package "Process 4: Client" <<main>> {
    [client_cli.py] as client
    [A2A Client] as a2a_client

    client --> a2a_client : uses

    note right of client
        Evaluation driver
        Sends EvalRequest
        Displays results
    end note
}

main -.-> orch : spawns\n(subprocess.Popen)
main -.-> attacker : spawns\n(subprocess.Popen)
main -.-> defender : spawns\n(subprocess.Popen)
main -.-> client : spawns\n(subprocess.Popen)

client --> orch : HTTP\nA2A Protocol
tool_prov --> attacker : HTTP\nA2A Protocol
tool_prov --> defender : HTTP\nA2A Protocol

legend right
    |<back:#E3F2FD>      | Main Process |
    |<back:#C8E6C9>      | Green Agent (Orchestrator) |
    |<back:#FFCDD2>      | Purple Agent (Attacker) |
    |<back:#FFF9C4>      | Purple Agent (Defender) |
endlegend

@enduml
